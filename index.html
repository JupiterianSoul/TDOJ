<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowTask - Gestionnaire de TÃ¢ches Intelligent</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            
            /* Theme colors */
            --theme-primary: var(--primary);
            --theme-secondary: var(--secondary);
            --theme-gradient: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-secondary) 100%);
            --theme-gradient-hover: linear-gradient(135deg, var(--primary-dark) 0%, var(--theme-secondary) 100%);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --bg-tertiary: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border: #d1d5db;
            --shadow: rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #475569;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* Header */
        header {
            background: var(--theme-gradient);
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 4px 20px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .logo-icon {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .header-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            min-width: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Navigation */
        nav {
            background: var(--bg-secondary);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-top: 1px solid var(--border);
        }

        .nav-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.5rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-item {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            flex: 1;
            max-width: 80px;
        }

        .nav-item .nav-icon {
            font-size: 1.5rem;
        }

        .nav-item:hover {
            color: var(--theme-primary);
            background: var(--bg-primary);
        }

        .nav-item.active {
            color: var(--theme-primary);
            background: var(--bg-primary);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* View Sections */
        .view-section {
            display: none;
            min-height: calc(100vh - 200px);
        }

        .view-section.active {
            display: block;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: 0 2px 10px var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--theme-gradient);
        }

        .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--theme-primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Task Input Section */
        .task-input-section {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-control {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        input, select, textarea {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--theme-primary);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .filter-btn:hover {
            border-color: var(--theme-primary);
            color: var(--theme-primary);
        }

        .filter-btn.active {
            background: var(--theme-gradient);
            color: white;
            border-color: var(--theme-primary);
        }

        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border);
            border-radius: 25px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--theme-primary);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Tasks Container */
        .tasks-container {
            display: grid;
            gap: 1rem;
        }

        /* Mobile Touch Support */
        .task-card {
            cursor: grab;
            touch-action: none;
            user-select: none;
        }

        .task-card:active {
            cursor: grabbing;
        }

        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            z-index: 1000;
        }

        .task-card.drag-over {
            border: 2px dashed var(--theme-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        /* Mobile Search Improvements */
        .search-input {
            -webkit-appearance: none;
            -webkit-border-radius: 25px;
        }

        .search-input::-webkit-search-cancel-button {
            -webkit-appearance: none;
        }

        .task-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .task-card.completed {
            opacity: 0.7;
        }

        .task-card.completed .task-title {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .task-priority {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
        }

        .task-priority.high { background: var(--danger); }
        .task-priority.medium { background: var(--warning); }
        .task-priority.low { background: var(--success); }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .task-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            flex: 1;
            margin-right: 0.5rem;
        }

        .task-meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 0.75rem;
        }

        .task-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .task-actions {
            display: flex;
            gap: 0.25rem;
            flex-shrink: 0;
        }

        .task-btn {
            padding: 0.4rem;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-btn:hover {
            background: var(--theme-primary);
            color: white;
        }

        /* Calendar */
        .calendar-container {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-header h2 {
            font-size: 1.2rem;
        }

        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }

        .calendar-nav .btn {
            padding: 0.5rem;
            font-size: 0.9rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--primary);
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 0.5rem 0.25rem;
            font-size: 0.75rem;
        }

        .calendar-cell {
            background: var(--bg-primary);
            padding: 0.5rem 0.25rem;
            min-height: 60px;
            position: relative;
            font-size: 0.85rem;
        }

        .calendar-cell.other-month {
            opacity: 0.3;
        }

        .calendar-cell.today {
            background: rgba(99, 102, 241, 0.1);
            font-weight: bold;
            color: var(--theme-primary);
        }

        .calendar-task {
            color: white;
            padding: 0.1rem 0.25rem;
            border-radius: 3px;
            font-size: 0.65rem;
            margin-top: 0.15rem;
            cursor: pointer;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .calendar-task.completed {
            background: var(--success);
        }

        .calendar-task.pending {
            background: var(--danger);
        }

        .calendar-task.overdue {
            background: #dc2626;
        }

        .calendar-task.no-deadline {
            background: var(--text-secondary);
        }

        /* Timer Section */
        .timer-section {
            display: grid;
            gap: 1.5rem;
        }

        .timer-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: 0 4px 15px var(--shadow);
            text-align: center;
        }

        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: var(--theme-primary);
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .timer-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: var(--theme-gradient);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 500;
        }

        .timer-btn:hover {
            background: var(--theme-gradient-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .timer-settings {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .timer-input {
            width: 80px;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            text-align: center;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Settings Section */
        .settings-section {
            display: grid;
            gap: 1.5rem;
        }

        .settings-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .settings-description {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: var(--transition);
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--theme-primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .danger-zone {
            border: 2px solid var(--danger);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .danger-title {
            color: var(--danger);
            font-weight: bold;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Color Theme Selector */
        .color-themes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .color-theme-option {
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            background: var(--bg-primary);
            position: relative;
            overflow: hidden;
        }

        .color-theme-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .color-theme-option.active {
            border-color: var(--theme-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .theme-preview {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .theme-name {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: 0 10px 40px var(--shadow);
            z-index: 3000;
            display: none;
            border-left: 4px solid var(--primary);
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .container {
                padding: 0.75rem;
            }

            .header-content {
                padding: 0;
            }

            .logo {
                font-size: 1.1rem;
            }

            .logo-icon {
                width: 30px;
                height: 30px;
                font-size: 1.1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .stat-card {
                padding: 0.75rem;
            }

            .stat-icon {
                font-size: 1.3rem;
            }

            .stat-value {
                font-size: 1.3rem;
            }

            .task-input-section {
                padding: 1rem;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .task-card {
                padding: 0.75rem;
            }

            .task-actions {
                flex-direction: row;
                gap: 0.5rem;
            }

            .task-btn {
                min-width: 36px;
                height: 36px;
                font-size: 1.1rem;
            }

            .calendar-container {
                padding: 0.75rem;
            }

            .calendar-cell {
                min-height: 50px;
                padding: 0.25rem 0.1rem;
            }

            .calendar-day-header {
                padding: 0.4rem 0.1rem;
            }

            .timer-display {
                font-size: 2.5rem;
            }

            .timer-card {
                padding: 1.5rem;
            }

            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .nav-content {
                overflow-x: auto;
                padding: 0.5rem;
            }

            .nav-item {
                min-width: 60px;
                padding: 0.4rem 0.2rem;
                font-size: 0.75rem;
            }

            .nav-item .nav-icon {
                font-size: 1.3rem;
            }

            /* Mobile search optimization */
            .search-container {
                margin-bottom: 1rem;
            }

            .search-input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 0.75rem 1rem 0.75rem 2.5rem;
            }

            /* Mobile filters */
            .filters {
                gap: 0.25rem;
                margin-bottom: 1rem;
            }

            .filter-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                flex-shrink: 0;
            }

            /* Mobile color themes */
            .color-themes {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .color-theme-option {
                padding: 0.75rem;
            }

            .theme-preview {
                height: 30px;
            }

            /* Mobile settings */
            .settings-item {
                padding: 0.75rem 0;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .settings-item > div:last-child {
                align-self: flex-end;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .calendar-cell {
                min-height: 45px;
                font-size: 0.8rem;
            }

            .calendar-task {
                font-size: 0.6rem;
                padding: 0.05rem 0.2rem;
            }

            .timer-display {
                font-size: 2rem;
            }

            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
            }
        }

        @media (min-width: 769px) {
            nav {
                position: static;
                border-top: none;
                border-bottom: 1px solid var(--border);
            }

            .nav-content {
                max-width: 1400px;
                justify-content: flex-start;
                gap: 2rem;
                padding: 1rem 1.5rem;
            }

            .nav-item {
                flex-direction: row;
                max-width: none;
                flex: none;
            }

            .nav-item .nav-icon {
                font-size: 1.2rem;
            }

            body {
                padding-bottom: 0;
            }

            .input-group {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .input-row {
                grid-template-columns: 1fr 1fr;
            }

            .calendar-cell {
                min-height: 80px;
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">â¡</div>
                <span>FlowTask</span>
            </div>
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()">ð</button>
                <button class="btn btn-secondary" onclick="exportTasks()">ð¥ Export</button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav>
        <div class="nav-content">
            <button class="nav-item active" onclick="switchView('dashboard')">
                <div class="nav-icon">ð</div>
                <span>Accueil</span>
            </button>
            <button class="nav-item" onclick="switchView('tasks')">
                <div class="nav-icon">ð</div>
                <span>TÃ¢ches</span>
            </button>
            <button class="nav-item" onclick="switchView('calendar')">
                <div class="nav-icon">ð</div>
                <span>Calendrier</span>
            </button>
            <button class="nav-item" onclick="switchView('timer')">
                <div class="nav-icon">â±ï¸</div>
                <span>Timer</span>
            </button>
            <button class="nav-item" onclick="switchView('stats')">
                <div class="nav-icon">ð</div>
                <span>Stats</span>
            </button>
            <button class="nav-item" onclick="switchView('settings')">
                <div class="nav-icon">âï¸</div>
                <span>RÃ©glages</span>
            </button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard View -->
        <div id="dashboard" class="view-section active">
            <!-- Stats Dashboard -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ð</div>
                    <div class="stat-value" id="totalTasks">0</div>
                    <div class="stat-label">TÃ¢ches totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â</div>
                    <div class="stat-value" id="completedTasks">0</div>
                    <div class="stat-label">TerminÃ©es</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â³</div>
                    <div class="stat-value" id="pendingTasks">0</div>
                    <div class="stat-label">En attente</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ð¥</div>
                    <div class="stat-value" id="streakDays">0</div>
                    <div class="stat-label">SÃ©rie active</div>
                </div>
            </div>

            <!-- Task Input Section -->
            <div class="task-input-section">
                <h2 style="margin-bottom: 1.5rem;">â Nouvelle tÃ¢che</h2>
                <div class="input-group">
                    <div class="form-control">
                        <label for="taskTitle">Titre de la tÃ¢che</label>
                        <input type="text" id="taskTitle" placeholder="Ex: Finir le rapport...">
                    </div>
                    <div class="input-row">
                        <div class="form-control">
                            <label for="taskCategory">CatÃ©gorie</label>
                            <select id="taskCategory">
                                <option value="work">ð¼ Travail</option>
                                <option value="personal">ð¤ Personnel</option>
                                <option value="urgent">ð¨ Urgent</option>
                                <option value="shopping">ð Courses</option>
                                <option value="health">ðª SantÃ©</option>
                            </select>
                        </div>
                        <div class="form-control">
                            <label for="taskPriority">PrioritÃ©</label>
                            <select id="taskPriority">
                                <option value="low">Faible</option>
                                <option value="medium">Moyenne</option>
                                <option value="high">Haute</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="form-control">
                            <label for="taskDeadline">ÃchÃ©ance</label>
                            <input type="datetime-local" id="taskDeadline">
                        </div>
                        <div class="form-control">
                            <label for="taskRecurring">RÃ©currence</label>
                            <select id="taskRecurring">
                                <option value="none">Aucune</option>
                                <option value="daily">Quotidienne</option>
                                <option value="weekly">Hebdomadaire</option>
                                <option value="monthly">Mensuelle</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-control">
                        <label for="taskDescription">Description</label>
                        <textarea id="taskDescription" placeholder="DÃ©tails de la tÃ¢che..."></textarea>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addTask()" style="background: var(--theme-gradient); color: white; width: 100%; border: none; transition: var(--transition);" onmouseover="this.style.background='var(--theme-gradient-hover)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'" onmouseout="this.style.background='var(--theme-gradient)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <span>â</span>
                    <span>Ajouter la tÃ¢che</span>
                </button>
            </div>
        </div>

        <!-- Tasks View -->
        <div id="tasks" class="view-section">
            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-icon">ð</div>
                <input type="text" class="search-input" id="searchInput" placeholder="Rechercher dans les tÃ¢ches..." oninput="handleSearch()">
            </div>
            
            <!-- Filters -->
            <div class="filters">
                <button class="filter-btn active" onclick="setFilter('all')">Toutes</button>
                <button class="filter-btn" onclick="setFilter('today')">Aujourd'hui</button>
                <button class="filter-btn" onclick="setFilter('week')">Cette semaine</button>
                <button class="filter-btn" onclick="setFilter('work')">ð¼ Travail</button>
                <button class="filter-btn" onclick="setFilter('personal')">ð¤ Personnel</button>
                <button class="filter-btn" onclick="setFilter('urgent')">ð¨ Urgent</button>
                <button class="filter-btn" onclick="setFilter('recurring')">ð RÃ©currentes</button>
                <button class="filter-btn" onclick="setFilter('completed')">â TerminÃ©es</button>
            </div>

            <!-- Tasks Container -->
            <div class="tasks-container" id="tasksContainer">
                <div class="empty-state">
                    <div class="empty-state-icon">ð</div>
                    <h3>Aucune tÃ¢che pour le moment</h3>
                    <p>Commencez par ajouter votre premiÃ¨re tÃ¢che!</p>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar" class="view-section">
            <div class="calendar-container">
                <div class="calendar-header">
                    <h2 id="calendarMonth">Janvier 2024</h2>
                    <div class="calendar-nav">
                        <button class="btn btn-secondary" onclick="previousMonth()">â¹</button>
                        <button class="btn btn-secondary" onclick="nextMonth()">âº</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>

        <!-- Timer View -->
        <div id="timer" class="view-section">
            <div class="timer-section">
                <div class="timer-card">
                    <h2 style="margin-bottom: 1.5rem;">â° Timer Pomodoro</h2>
                    <div class="timer-display" id="timerDisplay">25:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn" onclick="startTimer()">â¶ï¸ Start</button>
                        <button class="timer-btn" onclick="pauseTimer()">â¸ï¸ Pause</button>
                        <button class="timer-btn" onclick="resetTimer()">ð Reset</button>
                    </div>
                    <div class="timer-settings">
                        <input type="number" class="timer-input" id="timerMinutes" value="25" min="1" max="60">
                        <span style="color: var(--text-secondary);">minutes</span>
                        <button class="timer-btn" onclick="setTimer()">DÃ©finir</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics View -->
        <div id="stats" class="view-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">â¡</div>
                    <div class="stat-value" id="avgCompletionTime">-</div>
                    <div class="stat-label">Temps moyen (jours)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ð¯</div>
                    <div class="stat-value" id="completionRate">0%</div>
                    <div class="stat-label">Taux de rÃ©ussite</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ð</div>
                    <div class="stat-value" id="tasksThisWeek">0</div>
                    <div class="stat-label">Cette semaine</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ð</div>
                    <div class="stat-value" id="bestStreak">0</div>
                    <div class="stat-label">Meilleure sÃ©rie</div>
                </div>
            </div>

            <div class="task-input-section">
                <h2 style="margin-bottom: 1.5rem;">ð RÃ©partition par catÃ©gorie</h2>
                <div id="categoryStats"></div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings" class="view-section">
            <div class="settings-section">
                <div class="settings-card">
                    <h2 style="margin-bottom: 1.5rem;">âï¸ ParamÃ¨tres gÃ©nÃ©raux</h2>
                    
                    <div class="settings-item">
                        <div>
                            <div class="settings-label">Notifications</div>
                            <div class="settings-description">Recevoir des notifications pour les Ã©chÃ©ances</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notificationsEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="settings-item">
                        <div>
                            <div class="settings-label">Son du timer</div>
                            <div class="settings-description">Son Ã  la fin du timer Pomodoro</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="timerSoundEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="settings-item">
                        <div>
                            <div class="settings-label">Confirmation de suppression</div>
                            <div class="settings-description">Demander confirmation avant de supprimer une tÃ¢che</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="deleteConfirmationEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="settings-item">
                        <div>
                            <div class="settings-label">Animations de cÃ©lÃ©bration</div>
                            <div class="settings-description">Animations quand une tÃ¢che est terminÃ©e</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="celebrationEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="settings-item">
                        <div>
                            <div class="settings-label">Timer par dÃ©faut</div>
                            <div class="settings-description">DurÃ©e par dÃ©faut du timer Pomodoro</div>
                        </div>
                        <select id="defaultTimerDuration" style="width: 120px;">
                            <option value="15">15 minutes</option>
                            <option value="20">20 minutes</option>
                            <option value="25" selected>25 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                        </select>
                    </div>
                </div>

                <div class="settings-card">
                    <h2 style="margin-bottom: 1.5rem;">ð¨ ThÃ¨me de couleurs</h2>
                    
                    <div class="settings-item">
                        <div>
                            <div class="settings-label">Palette de couleurs</div>
                            <div class="settings-description">Choisissez votre thÃ¨me de couleurs prÃ©fÃ©rÃ©</div>
                        </div>
                    </div>
                    
                    <div class="color-themes">
                        <div class="color-theme-option active" onclick="setColorTheme('blue')" data-theme="blue">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);"></div>
                            <div class="theme-name">Bleu OcÃ©an</div>
                        </div>
                        
                        <div class="color-theme-option" onclick="setColorTheme('emerald')" data-theme="emerald">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);"></div>
                            <div class="theme-name">Ãmeraude</div>
                        </div>
                        
                        <div class="color-theme-option" onclick="setColorTheme('sunset')" data-theme="sunset">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);"></div>
                            <div class="theme-name">Coucher Soleil</div>
                        </div>
                        
                        <div class="color-theme-option" onclick="setColorTheme('rose')" data-theme="rose">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);"></div>
                            <div class="theme-name">Rose Passion</div>
                        </div>
                        
                        <div class="color-theme-option" onclick="setColorTheme('purple')" data-theme="purple">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);"></div>
                            <div class="theme-name">Violet Royal</div>
                        </div>
                        
                        <div class="color-theme-option" onclick="setColorTheme('teal')" data-theme="teal">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%);"></div>
                            <div class="theme-name">Turquoise</div>
                        </div>
                        
                        <div class="color-theme-option" onclick="setColorTheme('red')" data-theme="red">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);"></div>
                            <div class="theme-name">Rouge Feu</div>
                        </div>
                        
                        <div class="color-theme-option" onclick="setColorTheme('dark')" data-theme="dark">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #374151 0%, #6b7280 100%);"></div>
                            <div class="theme-name">Gris Sombre</div>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h2 style="margin-bottom: 1.5rem;">ð± Interface</h2>
                    
                    <div class="settings-item">
                        <div>
                            <div class="settings-label">ThÃ¨me sombre</div>
                            <div class="settings-description">Utiliser le thÃ¨me sombre pour l'interface</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="settings-item">
                        <div>
                            <div class="settings-label">Vue par dÃ©faut</div>
                            <div class="settings-description">Page affichÃ©e au dÃ©marrage</div>
                        </div>
                        <select id="defaultView" style="width: 120px;">
                            <option value="dashboard" selected>Accueil</option>
                            <option value="tasks">TÃ¢ches</option>
                            <option value="calendar">Calendrier</option>
                            <option value="timer">Timer</option>
                        </select>
                    </div>
                </div>

                <div class="danger-zone">
                    <div class="danger-title">
                        <span>â ï¸</span>
                        <span>Zone dangereuse</span>
                    </div>
                    <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                        Ces actions sont irrÃ©versibles. Soyez prudent.
                    </p>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-danger" onclick="clearCompletedTasks()">
                            ðï¸ Supprimer les tÃ¢ches terminÃ©es
                        </button>
                        <button class="btn btn-danger" onclick="resetAllData()">
                            ð¥ RÃ©initialiser toutes les donnÃ©es
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Application State
        let tasks = [];
        let currentFilter = 'all';
        let currentView = 'dashboard';
        let timerInterval = null;
        let timerSeconds = 1500; // 25 minutes
        let isDarkMode = false;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let searchQuery = '';
        let draggedTaskId = null;
        
        // Settings
        let settings = {
            notifications: true,
            timerSound: true,
            deleteConfirmation: true,
            celebration: true,
            defaultTimer: 25,
            defaultView: 'dashboard',
            colorTheme: 'blue'
        };

        // Color Themes
        const colorThemes = {
            blue: {
                primary: '#6366f1',
                primaryDark: '#4f46e5',
                secondary: '#8b5cf6'
            },
            emerald: {
                primary: '#10b981',
                primaryDark: '#059669',
                secondary: '#34d399'
            },
            sunset: {
                primary: '#f59e0b',
                primaryDark: '#d97706',
                secondary: '#f97316'
            },
            rose: {
                primary: '#ec4899',
                primaryDark: '#db2777',
                secondary: '#f472b6'
            },
            purple: {
                primary: '#8b5cf6',
                primaryDark: '#7c3aed',
                secondary: '#a855f7'
            },
            teal: {
                primary: '#14b8a6',
                primaryDark: '#0d9488',
                secondary: '#06b6d4'
            },
            red: {
                primary: '#ef4444',
                primaryDark: '#dc2626',
                secondary: '#f87171'
            },
            dark: {
                primary: '#374151',
                primaryDark: '#1f2937',
                secondary: '#6b7280'
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing FlowTask...');
            loadTasks();
            loadSettings();
            updateStats();
            renderTasks();
            renderCalendar();
            checkTheme();
            updateTimerDisplay();
            console.log('FlowTask ready!');
        });

        // View Management
        function switchView(viewName) {
            console.log('Switching to view:', viewName);
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Update content
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(viewName).classList.add('active');
            
            currentView = viewName;
            
            // Update view-specific content
            if (viewName === 'calendar') {
                renderCalendar();
            } else if (viewName === 'stats') {
                updateAdvancedStats();
                renderCategoryStats();
            } else if (viewName === 'settings') {
                updateSettingsUI();
            }
        }

        // Theme Management
        function toggleTheme() {
            console.log('Toggling theme');
            isDarkMode = !isDarkMode;
            document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
            document.querySelector('.theme-toggle').textContent = isDarkMode ? 'âï¸' : 'ð';
            saveSettings();
        }

        function toggleDarkMode() {
            toggleTheme();
            document.getElementById('darkModeToggle').checked = isDarkMode;
        }

        function checkTheme() {
            if (settings && settings.darkMode) {
                isDarkMode = true;
                document.documentElement.setAttribute('data-theme', 'dark');
                document.querySelector('.theme-toggle').textContent = 'âï¸';
            }
        }

        // Settings Management
        function loadSettings() {
            const saved = JSON.parse(localStorage.getItem('taskMasterSettings') || '{}');
            settings = { ...settings, ...saved };
            isDarkMode = settings.darkMode || false;
            applyColorTheme(settings.colorTheme || 'blue');
        }

        function saveSettings() {
            settings.darkMode = isDarkMode;
            settings.notifications = document.getElementById('notificationsEnabled')?.checked ?? settings.notifications;
            settings.timerSound = document.getElementById('timerSoundEnabled')?.checked ?? settings.timerSound;
            settings.deleteConfirmation = document.getElementById('deleteConfirmationEnabled')?.checked ?? settings.deleteConfirmation;
            settings.celebration = document.getElementById('celebrationEnabled')?.checked ?? settings.celebration;
            settings.defaultTimer = parseInt(document.getElementById('defaultTimerDuration')?.value) || settings.defaultTimer;
            settings.defaultView = document.getElementById('defaultView')?.value || settings.defaultView;
            
            localStorage.setItem('taskMasterSettings', JSON.stringify(settings));
        }

        function setColorTheme(themeName) {
            console.log('Setting color theme:', themeName);
            settings.colorTheme = themeName;
            applyColorTheme(themeName);
            updateColorThemeUI();
            saveSettings();
            showNotification(`ThÃ¨me "${getThemeName(themeName)}" appliquÃ©!`, 'success');
        }

        function applyColorTheme(themeName) {
            const theme = colorThemes[themeName];
            if (theme) {
                const root = document.documentElement;
                root.style.setProperty('--theme-primary', theme.primary);
                root.style.setProperty('--theme-secondary', theme.secondary);
                root.style.setProperty('--theme-gradient', `linear-gradient(135deg, ${theme.primary} 0%, ${theme.secondary} 100%)`);
                root.style.setProperty('--theme-gradient-hover', `linear-gradient(135deg, ${theme.primaryDark} 0%, ${theme.secondary} 100%)`);
            }
        }

        function updateColorThemeUI() {
            document.querySelectorAll('.color-theme-option').forEach(option => {
                option.classList.remove('active');
            });
            const activeTheme = document.querySelector(`[data-theme="${settings.colorTheme}"]`);
            if (activeTheme) {
                activeTheme.classList.add('active');
            }
        }

        function getThemeName(themeKey) {
            const names = {
                blue: 'Bleu OcÃ©an',
                emerald: 'Ãmeraude',
                sunset: 'Coucher Soleil',
                rose: 'Rose Passion',
                purple: 'Violet Royal',
                teal: 'Turquoise',
                red: 'Rouge Feu',
                dark: 'Gris Sombre'
            };
            return names[themeKey] || themeKey;
        }

        function updateSettingsUI() {
            document.getElementById('notificationsEnabled').checked = settings.notifications;
            document.getElementById('timerSoundEnabled').checked = settings.timerSound;
            document.getElementById('deleteConfirmationEnabled').checked = settings.deleteConfirmation;
            document.getElementById('celebrationEnabled').checked = settings.celebration;
            document.getElementById('defaultTimerDuration').value = settings.defaultTimer;
            document.getElementById('defaultView').value = settings.defaultView;
            document.getElementById('darkModeToggle').checked = isDarkMode;
            updateColorThemeUI();
        }

        function clearCompletedTasks() {
            const confirmMsg = settings.deleteConfirmation ? 
                'Ãtes-vous sÃ»r de vouloir supprimer toutes les tÃ¢ches terminÃ©es?' : true;
            
            if (confirmMsg === true || confirm(confirmMsg)) {
                const beforeCount = tasks.length;
                tasks = tasks.filter(task => !task.completed);
                const deletedCount = beforeCount - tasks.length;
                saveTasks();
                renderTasks();
                updateStats();
                showNotification(`${deletedCount} tÃ¢che(s) terminÃ©e(s) supprimÃ©e(s)`, 'success');
            }
        }

        function resetAllData() {
            const confirmMsg = settings.deleteConfirmation ? 
                'ATTENTION: Cette action supprimera TOUTES vos donnÃ©es (tÃ¢ches, paramÃ¨tres, statistiques). Ãtes-vous sÃ»r?' : true;
            
            if (confirmMsg === true || confirm(confirmMsg)) {
                tasks = [];
                settings = {
                    notifications: true,
                    timerSound: true,
                    deleteConfirmation: true,
                    celebration: true,
                    defaultTimer: 25,
                    defaultView: 'dashboard'
                };
                localStorage.removeItem('taskMasterTasks');
                localStorage.removeItem('taskMasterSettings');
                updateStats();
                renderTasks();
                updateSettingsUI();
                showNotification('Toutes les donnÃ©es ont Ã©tÃ© rÃ©initialisÃ©es', 'success');
            }
        }

        // Filter Management
        function setFilter(filterType) {
            console.log('Setting filter:', filterType);
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentFilter = filterType;
            renderTasks();
        }

        // Task Management
        function addTask() {
            console.log('Adding task...');
            const title = document.getElementById('taskTitle').value.trim();
            const category = document.getElementById('taskCategory').value;
            const priority = document.getElementById('taskPriority').value;
            const deadline = document.getElementById('taskDeadline').value;
            const description = document.getElementById('taskDescription').value.trim();
            const recurring = document.getElementById('taskRecurring').value;
            
            if (!title) {
                showNotification('Veuillez entrer un titre pour la tÃ¢che', 'error');
                return;
            }
            
            const task = {
                id: Date.now(),
                title,
                category,
                priority,
                deadline,
                description,
                recurring,
                completed: false,
                createdAt: new Date().toISOString(),
                completedAt: null,
                lastRecurring: null,
                sortOrder: tasks.length
            };
            
            tasks.unshift(task);
            saveTasks();
            renderTasks();
            updateStats();
            clearForm();
            showNotification('TÃ¢che ajoutÃ©e avec succÃ¨s!', 'success');
        }

        function deleteTask(id) {
            const confirmMsg = settings.deleteConfirmation ? 
                'Ãtes-vous sÃ»r de vouloir supprimer cette tÃ¢che?' : true;
            
            if (confirmMsg === true || confirm(confirmMsg)) {
                const taskIndex = tasks.findIndex(task => task.id === id);
                if (taskIndex !== -1) {
                    tasks.splice(taskIndex, 1);
                    // Update sort orders after deletion
                    tasks.forEach((task, index) => {
                        task.sortOrder = index;
                    });
                    saveTasks();
                    renderTasks();
                    updateStats();
                    showNotification('TÃ¢che supprimÃ©e', 'success');
                }
            }
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                if (task.completed) {
                    task.completedAt = new Date().toISOString();
                    
                    // Handle recurring tasks
                    if (task.recurring && task.recurring !== 'none') {
                        setTimeout(() => {
                            createRecurringTask(task);
                        }, 1000);
                    }
                    
                    if (settings.celebration) {
                        celebrate();
                    }
                } else {
                    task.completedAt = null;
                }
                saveTasks();
                renderTasks();
                updateStats();
            }
        }

        function createRecurringTask(originalTask) {
            const newTask = {
                ...originalTask,
                id: Date.now(),
                completed: false,
                createdAt: new Date().toISOString(),
                completedAt: null,
                lastRecurring: originalTask.id,
                sortOrder: tasks.length
            };
            
            // Calculate next deadline based on recurring type
            if (originalTask.deadline) {
                const deadline = new Date(originalTask.deadline);
                switch (originalTask.recurring) {
                    case 'daily':
                        deadline.setDate(deadline.getDate() + 1);
                        break;
                    case 'weekly':
                        deadline.setDate(deadline.getDate() + 7);
                        break;
                    case 'monthly':
                        deadline.setMonth(deadline.getMonth() + 1);
                        break;
                }
                newTask.deadline = deadline.toISOString().slice(0, 16);
            }
            
            tasks.unshift(newTask);
            saveTasks();
            renderTasks();
            updateStats();
            showNotification(`TÃ¢che rÃ©currente crÃ©Ã©e: ${newTask.title}`, 'success');
        }

        // Search Functionality
        function handleSearch() {
            searchQuery = document.getElementById('searchInput').value.toLowerCase().trim();
            renderTasks();
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskCategory').value = task.category;
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskDeadline').value = task.deadline;
                document.getElementById('taskDescription').value = task.description;
                document.getElementById('taskRecurring').value = task.recurring || 'none';
                deleteTask(id);
                document.getElementById('taskTitle').focus();
                switchView('dashboard');
            }
        }

        // Drag and Drop Functions (with mobile support)
        let touchStartY = 0;
        let touchStartX = 0;
        let isDragging = false;

        function handleDragStart(e) {
            draggedTaskId = parseInt(e.target.dataset.id);
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            const targetCard = e.target.closest('.task-card');
            if (targetCard && parseInt(targetCard.dataset.id) !== draggedTaskId) {
                targetCard.classList.add('drag-over');
            }
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.task-card').forEach(card => {
                card.classList.remove('drag-over');
            });
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetCard = e.target.closest('.task-card');
            
            if (targetCard && draggedTaskId) {
                const targetId = parseInt(targetCard.dataset.id);
                
                if (targetId !== draggedTaskId) {
                    reorderTasks(draggedTaskId, targetId);
                }
            }
            
            targetCard?.classList.remove('drag-over');
        }

        // Touch support for mobile drag and drop
        function addTouchSupport() {
            document.addEventListener('DOMContentLoaded', function() {
                const tasksContainer = document.getElementById('tasksContainer');
                if (tasksContainer) {
                    tasksContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
                    tasksContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
                    tasksContainer.addEventListener('touchend', handleTouchEnd, { passive: false });
                }
            });
        }

        function handleTouchStart(e) {
            const taskCard = e.target.closest('.task-card');
            if (taskCard && !e.target.closest('.task-btn')) {
                touchStartY = e.touches[0].clientY;
                touchStartX = e.touches[0].clientX;
                draggedTaskId = parseInt(taskCard.dataset.id);
                
                setTimeout(() => {
                    if (draggedTaskId) {
                        taskCard.classList.add('dragging');
                        isDragging = true;
                    }
                }, 200);
            }
        }

        function handleTouchMove(e) {
            if (!isDragging || !draggedTaskId) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const targetCard = elementBelow?.closest('.task-card');
            
            // Remove drag-over from all cards
            document.querySelectorAll('.task-card').forEach(card => {
                card.classList.remove('drag-over');
            });
            
            if (targetCard && parseInt(targetCard.dataset.id) !== draggedTaskId) {
                targetCard.classList.add('drag-over');
            }
        }

        function handleTouchEnd(e) {
            if (!isDragging) return;
            
            const touch = e.changedTouches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const targetCard = elementBelow?.closest('.task-card');
            
            if (targetCard && draggedTaskId) {
                const targetId = parseInt(targetCard.dataset.id);
                if (targetId !== draggedTaskId) {
                    reorderTasks(draggedTaskId, targetId);
                }
            }
            
            // Cleanup
            document.querySelectorAll('.task-card').forEach(card => {
                card.classList.remove('dragging', 'drag-over');
            });
            
            isDragging = false;
            draggedTaskId = null;
        }

        function reorderTasks(draggedId, targetId) {
            const draggedIndex = tasks.findIndex(t => t.id === draggedId);
            const targetIndex = tasks.findIndex(t => t.id === targetId);
            
            if (draggedIndex !== -1 && targetIndex !== -1) {
                const [draggedTask] = tasks.splice(draggedIndex, 1);
                tasks.splice(targetIndex, 0, draggedTask);
                
                // Update sort orders
                tasks.forEach((task, index) => {
                    task.sortOrder = index;
                });
                
                saveTasks();
                renderTasks();
                showNotification('TÃ¢ches rÃ©organisÃ©es', 'success');
            }
        }

        // Initialize touch support
        addTouchSupport();

        // Render Functions
        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            const filteredTasks = filterTasks();
            
            if (filteredTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ð</div>
                        <h3>Aucune tÃ¢che trouvÃ©e</h3>
                        <p>Ajoutez une nouvelle tÃ¢che ou changez le filtre</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredTasks.map(task => createTaskCard(task)).join('');
        }

        function createTaskCard(task) {
            const recurringIcon = task.recurring && task.recurring !== 'none' ? 
                `<span class="task-badge" style="background: var(--theme-primary); color: white;">ð ${getRecurringName(task.recurring)}</span>` : '';
            
            return `
                <div class="task-card ${task.completed ? 'completed' : ''}" 
                     data-id="${task.id}" 
                     draggable="true" 
                     ondragstart="handleDragStart(event)" 
                     ondragover="handleDragOver(event)" 
                     ondrop="handleDrop(event)" 
                     ondragend="handleDragEnd(event)">
                    <div class="task-priority ${task.priority}"></div>
                    <div class="task-header">
                        <div style="flex: 1;">
                            <h3 class="task-title">${escapeHtml(task.title)}</h3>
                            <div class="task-meta">
                                <span class="task-badge">${getCategoryIcon(task.category)} ${getCategoryName(task.category)}</span>
                                <span class="task-badge">â¡ ${getPriorityName(task.priority)}</span>
                                ${recurringIcon}
                                ${task.deadline ? `<span class="task-badge">ð ${formatDate(task.deadline)}</span>` : ''}
                            </div>
                            ${task.description ? `<p style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">${escapeHtml(task.description)}</p>` : ''}
                        </div>
                        <div class="task-actions">
                            <button class="task-btn" onclick="toggleTask(${task.id})" title="Marquer comme ${task.completed ? 'non terminÃ©e' : 'terminÃ©e'}">
                                ${task.completed ? 'â©ï¸' : 'â'}
                            </button>
                            <button class="task-btn" onclick="editTask(${task.id})" title="Modifier">âï¸</button>
                            <button class="task-btn" onclick="deleteTask(${task.id})" title="Supprimer">ðï¸</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter Tasks
        function filterTasks() {
            let filtered = [...tasks];
            
            // Apply search filter first
            if (searchQuery) {
                filtered = filtered.filter(task => 
                    task.title.toLowerCase().includes(searchQuery) ||
                    task.description.toLowerCase().includes(searchQuery) ||
                    getCategoryName(task.category).toLowerCase().includes(searchQuery)
                );
            }
            
            // Apply category/time filters
            switch(currentFilter) {
                case 'today':
                    const today = new Date();
                    filtered = filtered.filter(task => {
                        if (!task.deadline) return false;
                        const deadline = new Date(task.deadline);
                        return deadline.toDateString() === today.toDateString();
                    });
                    break;
                case 'week':
                    const weekFromNow = new Date();
                    weekFromNow.setDate(weekFromNow.getDate() + 7);
                    filtered = filtered.filter(task => {
                        if (!task.deadline) return false;
                        const deadline = new Date(task.deadline);
                        return deadline <= weekFromNow && deadline >= new Date();
                    });
                    break;
                case 'completed':
                    filtered = filtered.filter(task => task.completed);
                    break;
                case 'recurring':
                    filtered = filtered.filter(task => task.recurring && task.recurring !== 'none');
                    break;
                case 'work':
                case 'personal':
                case 'urgent':
                case 'shopping':
                case 'health':
                    filtered = filtered.filter(task => task.category === currentFilter);
                    break;
            }
            
            return filtered.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                if (a.priority !== b.priority) {
                    const priorityOrder = { high: 0, medium: 1, low: 2 };
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                }
                return (a.sortOrder || 0) - (b.sortOrder || 0);
            });
        }

        // Calendar Functions
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthNames = ['Janvier', 'FÃ©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
                              'Juillet', 'AoÃ»t', 'Septembre', 'Octobre', 'Novembre', 'DÃ©cembre'];
            
            document.getElementById('calendarMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            let html = '';
            
            // Days of week headers
            const dayNames = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
            dayNames.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                html += `<div class="calendar-cell other-month"></div>`;
            }
            
            // Current month days
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = today.getDate() === day && 
                               today.getMonth() === currentMonth && 
                               today.getFullYear() === currentYear;
                
                const dayTasks = getTasksForDay(currentYear, currentMonth, day);
                const tasksHtml = dayTasks.slice(0, 2).map(task => {
                    let taskClass = 'no-deadline';
                    if (task.completed) {
                        taskClass = 'completed';
                    } else if (task.deadline) {
                        const deadline = new Date(task.deadline);
                        const now = new Date();
                        taskClass = deadline < now ? 'overdue' : 'pending';
                    }
                    
                    return `<div class="calendar-task ${taskClass}" title="${escapeHtml(task.title)} - ${task.completed ? 'TerminÃ©e' : 'En cours'}" onclick="openTask(${task.id})">${task.title.substring(0, 8)}${task.title.length > 8 ? '...' : ''}</div>`;
                }).join('');
                
                html += `
                    <div class="calendar-cell ${isToday ? 'today' : ''}">
                        <div style="font-weight: ${isToday ? 'bold' : 'normal'};">${day}</div>
                        ${tasksHtml}
                        ${dayTasks.length > 2 ? `<div class="calendar-task no-deadline" style="background: var(--text-secondary); opacity: 0.7;">+${dayTasks.length - 2}</div>` : ''}
                    </div>
                `;
            }
            
            grid.innerHTML = html;
        }

        function openTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                // Switch to tasks view and highlight the task
                switchView('tasks');
                setTimeout(() => {
                    const taskCard = document.querySelector(`[data-id="${taskId}"]`);
                    if (taskCard) {
                        taskCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        taskCard.style.background = 'rgba(99, 102, 241, 0.1)';
                        taskCard.style.border = '2px solid var(--theme-primary)';
                        setTimeout(() => {
                            taskCard.style.background = '';
                            taskCard.style.border = '';
                        }, 2000);
                    }
                }, 100);
            }
        }

        function getTasksForDay(year, month, day) {
            return tasks.filter(task => {
                if (!task.deadline) return false;
                const deadline = new Date(task.deadline);
                return deadline.getDate() === day && 
                       deadline.getMonth() === month && 
                       deadline.getFullYear() === year;
            });
        }

        function previousMonth() {
            console.log('Previous month');
            if (currentMonth === 0) {
                currentMonth = 11;
                currentYear--;
            } else {
                currentMonth--;
            }
            renderCalendar();
        }

        function nextMonth() {
            console.log('Next month');
            if (currentMonth === 11) {
                currentMonth = 0;
                currentYear++;
            } else {
                currentMonth++;
            }
            renderCalendar();
        }

        // Statistics
        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;
            
            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('pendingTasks').textContent = pending;
            document.getElementById('streakDays').textContent = calculateStreak();
        }

        function updateAdvancedStats() {
            const completed = tasks.filter(t => t.completed);
            const total = tasks.length;
            
            // Completion rate
            const completionRate = total > 0 ? Math.round((completed.length / total) * 100) : 0;
            document.getElementById('completionRate').textContent = completionRate + '%';
            
            // Average completion time
            const avgTime = calculateAverageCompletionTime();
            document.getElementById('avgCompletionTime').textContent = avgTime;
            
            // Tasks this week
            const tasksThisWeek = getTasksThisWeek();
            document.getElementById('tasksThisWeek').textContent = tasksThisWeek;
            
            // Best streak
            document.getElementById('bestStreak').textContent = calculateBestStreak();
        }

        function calculateAverageCompletionTime() {
            const completedTasks = tasks.filter(t => t.completed && t.completedAt && t.createdAt);
            
            if (completedTasks.length === 0) return '-';
            
            const totalDays = completedTasks.reduce((sum, task) => {
                const created = new Date(task.createdAt);
                const completed = new Date(task.completedAt);
                const diffTime = Math.abs(completed - created);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return sum + diffDays;
            }, 0);
            
            const average = totalDays / completedTasks.length;
            return average < 1 ? '<1' : Math.round(average);
        }

        function getTasksThisWeek() {
            const now = new Date();
            const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            return tasks.filter(task => {
                const created = new Date(task.createdAt);
                return created >= weekStart && created <= weekEnd;
            }).length;
        }

        function renderCategoryStats() {
            const container = document.getElementById('categoryStats');
            const categories = {};
            
            tasks.forEach(task => {
                categories[task.category] = (categories[task.category] || 0) + 1;
            });
            
            const html = Object.entries(categories).map(([category, count]) => `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 1rem; background: var(--bg-primary); border-radius: 8px;">
                    <span>${getCategoryIcon(category)} ${getCategoryName(category)}</span>
                    <span style="font-weight: bold; color: var(--primary);">${count}</span>
                </div>
            `).join('');
            
            container.innerHTML = html || '<p style="text-align: center; color: var(--text-secondary);">Aucune donnÃ©e disponible</p>';
        }

        function calculateStreak() {
            const today = new Date().toDateString();
            const todayCompleted = tasks.some(t => 
                t.completed && t.completedAt && new Date(t.completedAt).toDateString() === today
            );
            return todayCompleted ? 1 : 0;
        }

        function calculateBestStreak() {
            const completedTasks = tasks.filter(t => t.completed && t.completedAt)
                                       .sort((a, b) => new Date(a.completedAt) - new Date(b.completedAt));
            
            if (completedTasks.length === 0) return 0;
            
            let streak = 0;
            let maxStreak = 0;
            let currentDate = null;
            
            completedTasks.forEach(task => {
                const taskDate = new Date(task.completedAt).toDateString();
                if (taskDate === currentDate) {
                    streak++;
                } else {
                    maxStreak = Math.max(maxStreak, streak);
                    streak = 1;
                    currentDate = taskDate;
                }
            });
            
            return Math.max(maxStreak, streak);
        }

        // Timer Functions
function startTimer() {
    console.log('Starting timer');
    if (!timerInterval) {
        timerInterval = setInterval(() => {
            timerSeconds--;
            updateTimerDisplay();
            if (timerSeconds <= 0) {
                pauseTimer();
                showNotification('Pomodoro timer completed!');
                if (settings.timerSound) {
                    playSoundMultipleTimes(3); // â CHANGED THIS LINE
                }
            }
        }, 1000);
    }
}

function pauseTimer() {
    console.log('Pausing timer');
    clearInterval(timerInterval);
    timerInterval = null;
}

// â PASTE THE NEW FUNCTION HERE
function playSoundMultipleTimes(count = 3) {
    for (let i = 0; i < count; i++) {
        setTimeout(() => {
            playSound();
        }, i * 1000);
    }
}

        function pauseTimer() {
            console.log('Pausing timer');
            clearInterval(timerInterval);
            timerInterval = null;
        }

        function resetTimer() {
            console.log('Resetting timer');
            pauseTimer();
            const minutes = parseInt(document.getElementById('timerMinutes').value) || settings.defaultTimer;
            timerSeconds = minutes * 60;
            updateTimerDisplay();
        }

        function setTimer() {
            console.log('Setting timer');
            const minutes = parseInt(document.getElementById('timerMinutes').value);
            if (minutes && minutes > 0 && minutes <= 60) {
                pauseTimer();
                timerSeconds = minutes * 60;
                updateTimerDisplay();
                showNotification(`Timer rÃ©glÃ© sur ${minutes} minutes`, 'success');
            } else {
                showNotification('Veuillez entrer une valeur entre 1 et 60 minutes', 'error');
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Storage Functions
        function saveTasks() {
            localStorage.setItem('taskMasterTasks', JSON.stringify(tasks));
        }

        function loadTasks() {
            const saved = localStorage.getItem('taskMasterTasks');
            if (saved) {
                try {
                    tasks = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading tasks:', e);
                    tasks = [];
                }
            }
        }

        function exportTasks() {
            console.log('Exporting tasks');
            const dataStr = JSON.stringify(tasks, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `tasks_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('TÃ¢ches exportÃ©es avec succÃ¨s!', 'success');
        }

        // Notification Functions
        function showNotification(message, type = 'info') {
            if (!settings.notifications && type !== 'error') return;
            
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Utility Functions
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { 
                day: '2-digit', 
                month: 'short', 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            };
            return date.toLocaleDateString('fr-FR', options);
        }

        function getCategoryIcon(category) {
            const icons = {
                work: 'ð¼',
                personal: 'ð¤',
                urgent: 'ð¨',
                shopping: 'ð',
                health: 'ðª'
            };
            return icons[category] || 'ð';
        }

        function getCategoryName(category) {
            const names = {
                work: 'Travail',
                personal: 'Personnel',
                urgent: 'Urgent',
                shopping: 'Courses',
                health: 'SantÃ©'
            };
            return names[category] || category;
        }

        function getPriorityName(priority) {
            const names = {
                low: 'Faible',
                medium: 'Moyenne',
                high: 'Haute'
            };
            return names[priority] || priority;
        }

        function clearForm() {
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskDeadline').value = '';
            document.getElementById('taskCategory').value = 'work';
            document.getElementById('taskPriority').value = 'medium';
            document.getElementById('taskRecurring').value = 'none';
        }

        function getRecurringName(recurring) {
            const names = {
                daily: 'Quotidienne',
                weekly: 'Hebdomadaire',
                monthly: 'Mensuelle',
                none: ''
            };
            return names[recurring] || '';
        }

        function celebrate() {
            const colors = ['#6366f1', '#8b5cf6', '#10b981', '#f59e0b', '#ec4899'];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.style.position = 'fixed';
                    particle.style.width = '6px';
                    particle.style.height = '6px';
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = '-20px';
                    particle.style.borderRadius = '50%';
                    particle.style.zIndex = '9999';
                    particle.style.pointerEvents = 'none';
                    document.body.appendChild(particle);
                    
                    let pos = -20;
                    const gravity = 0.5;
                    let velocity = Math.random() * 5 + 3;
                    
                    const animate = () => {
                        velocity += gravity;
                        pos += velocity;
                        particle.style.top = pos + 'px';
                        particle.style.opacity = Math.max(0, 1 - (pos / window.innerHeight));
                        
                        if (pos < window.innerHeight + 50) {
                            requestAnimationFrame(animate);
                        } else {
                            particle.remove();
                        }
                    };
                    
                    requestAnimationFrame(animate);
                }, i * 50);
            }
        }

        function playSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // Event listeners for settings changes
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for settings changes
            setTimeout(() => {
                const settingsInputs = ['notificationsEnabled', 'timerSoundEnabled', 'deleteConfirmationEnabled', 'celebrationEnabled', 'defaultTimerDuration', 'defaultView'];
                
                settingsInputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('change', saveSettings);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
